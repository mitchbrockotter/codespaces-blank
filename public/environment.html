<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment - P&K Backend Automation</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar dashboard-navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <a href="/dashboard" class="navbar-brand">
                    <img src="/images/logo.png" alt="P&K Backend Automation Logo" class="navbar-logo">
                    <span>P&K Backend Automation</span>
                </a>
            </div>
            <div class="navbar-right">
                <span id="userDisplay" class="user-display"></span>
                <button id="logoutBtn" class="btn btn-small">Logout</button>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="/dashboard" class="menu-item">Dashboard</a></li>
                <li><a href="/environment" class="menu-item active">My Environment</a></li>
                <li><a href="#" class="menu-item">Settings</a></li>
                <li><a href="#" class="menu-item">Support</a></li>
            </ul>
        </aside>

        <main class="dashboard-content">
            <div class="content-header">
                <h1>Your Report Environment</h1>
                <p>Access the automation tool you have been granted for this environment</p>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>üåç Environment Details</h3>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Environment Name:</span>
                            <span id="envName" class="info-value">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Company:</span>
                            <span id="envCompany" class="info-value">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span id="envStatus" class="info-value status-operational">Operational</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Uptime:</span>
                            <span id="envUptime" class="info-value">-</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>üîß Your Tool</h3>
                    <div class="card-content" id="envTools">
                        <p class="info-value" style="margin-bottom: 0.75rem;">Report Generator</p>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Generate a fresh report on demand.</p>
                        <a href="/app" class="btn btn-primary" style="display: inline-block;">Generate report</a>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>üìä Usage overview</h3>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">Runs completed:</span>
                            <span id="envRuns" class="info-value">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Estimated savings:</span>
                            <span id="envSavings" class="info-value">-</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>üîê Quick Links</h3>
                    <div class="card-content">
                        <a href="/app" class="link-button">Open report tool</a>
                        <a href="#" class="link-button">Request support</a>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h2>Environment Metrics</h2>
                <div class="metrics-table">
                    <div class="metric-row">
                        <span class="metric-label">CPU Usage</span>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: 45%;"></div>
                        </div>
                        <span class="metric-value">45%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Memory Usage</span>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: 62%;"></div>
                        </div>
                        <span class="metric-value">62%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Disk Usage</span>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: 78%;"></div>
                        </div>
                        <span class="metric-value">78%</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/env.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/environment.js"></script>
    <script>
        // Prevent page load if not authenticated
        console.log('üîê Environment page auth check...');
        const userJson = localStorage.getItem('user');
        if (!userJson) {
            console.warn('‚ùå No user in localStorage, redirecting to login...');
            setTimeout(() => { window.location.href = '/login'; }, 100);
        } else {
            try {
                const user = JSON.parse(userJson);
                console.log('üë§ Found user in localStorage:', user.username);
                console.log('‚úÖ User is authenticated, allowing access');
            } catch (e) {
                console.error('‚ùå Error parsing user from localStorage:', e);
                setTimeout(() => { window.location.href = '/login'; }, 100);
            }
        }
    </script>
</body>
</html>
